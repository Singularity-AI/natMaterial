<html xmlns:th="http://www.thymeleaf.org"> 
<head>
	<title>HealthAdapterFacadeGUI</title>
 	<link href="/disi.css" rel="stylesheet">
 	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
 	<meta name="viewport" content="width=device-width, initial-scale=1.0">

  <script>
    var  messagesOutput = document.getElementById("messages");
     
    function started(){
    	$("i.infoArea").text(  "application started" );
    }
    
    function cleanOutputArea() {
    	$("pre.resultArea").text(  "" );
 	}
 	
     function searchEvent() {
     		messagesOutput.value =  '\r';
             // Connect to the server
            eventSource = new EventSource("/searchPatient");
            // Receive messages
            eventSource.onmessage = function (event) {
                messagesOutput.value += event.data + '\r';
            };
            eventSource.onerror = function (e) {
                console.log("EventSource failed: " + e);
            };  	  	
    }
    
    function searchPatient(){
     	var patientid = document.getElementById("patientname").value;
      	$("i.infoArea").text(  "searching ..." + patientid );	
    	$("pre.resultArea").text(  "" );
		$.get("searchPatient/"+patientid, function(data){	//calls MI?	HI will return the page ...
 			 //$(document).ready(function(){
  				$("pre.resultArea").text(  data );
 			 //});
    	$("i.infoArea").text(  "searching done" );	
 		});  
    }
    
    function readResource(){
      	$("i.infoArea").text(  "reading ..." );	
    	$("pre.resultArea").text(  "" );
    	var patientid = document.getElementById("patientid").value;
    	//alert( patientid  );
		$.get("readResource/"+patientid, function(data){	 
  				$("pre.resultArea").text(  data );
     			$("i.infoArea").text(  "read done" );	
 		});  
    }

	//See https://www.html.it/pag/66525/fetch-api/
	//https://www.javascripture.com/Response - replacement for XMLHttpRequest (https://www.javascripture.com/XMLHttpRequest).
     function createPatient() {
    	var patientid = document.getElementById("patientname").value;
      	$("i.infoArea").text(  "creating patient ... " + patientid );	
        fetch("/createPatient", {method: "POST", body: patientid}).then(function (response) {
        	if (response.ok) {
        		console.log(  "creation done of " +  patientid + "  " + response );
      			return response.text() ;		// 
      		}}).then( function (id) {
      			$("i.infoArea").text(  "creation done of " +  patientid + " id=" + id);	
      		});
         
    }
 
 
    function deleteResource() {
    	userNameInput  = document.getElementById("patientid");
        var message   =  userNameInput.value;
    	//console.log("sendDelete "+ message);
    	$("i.infoArea").text(  "deleting ..." );	
        fetch("/deleteResource", {method: "POST", body: message}).then(function (response) {
        	if (response.ok) {
	            //userNameInput.value = "";
	            userNameInput.focus();
	            $("i.infoArea").text(  "deletion "+ message + " done" );	
            }
        });           
    }


</script>

 </head>
 

<body onload=started()>


<h1>AdapterFacade GUI</h1>

<h2>References</h2>
<ul>
<li><a href="http://htmlpreview.github.com/?https://github.com/anatali/natmaterial/blob/master/health/userDocs/HealthReferences.html" target="web"> 
DISI - HealthReferences.html</a> (on <tt>natmaterial .... health/userDocs/</tt>) </li>

<li><a href="http://htmlpreview.github.com/?https://github.com/anatali/natmaterial/blob/master/it.unibo.hapi2.2/userDocs/HapiUsage.html" target="web"> 
DISI - HapiUsage.html</a> (on <tt>natMicroservices .... it.unibo.hapi2.2/userDocs/</tt>) </li>

<li><a href="http://htmlpreview.github.com/?https://github.com/anatali/natmaterial/blob/master/health/userDocs/HapiFhirUsage.html" target="web"> 
DISI - HapiFhirUsage.html</a> (on <tt>natMicroservices .... it.unibo.mirth.java/userDocs/</tt>) </li>
</ul>
 
<h3>State: <i class="infoArea"></i></h3> 


<h4>InputArea</h4>
<div>
Patient name: <input id="patientname" type="text" size="15" autofocus/>  
    <button onclick="createPatient()">Create</button>
    <button onclick="searchPatient()">Search</button>
<br/><br/>
Patient ident: <input id="patientid" type="text" size="15" autofocus/> 
    <button onclick="readResource()">Read</button> <button onclick="deleteResource()">Delete</button>  <br/>
</div>


<h4>OutputArea <button onclick="cleanOutputArea()">Clean</button></h4> 
<pre class="resultArea"><span th:text="${outField}">waiting ... </span></i></pre>

 </p>
 
 
 
 
</body>
</html>